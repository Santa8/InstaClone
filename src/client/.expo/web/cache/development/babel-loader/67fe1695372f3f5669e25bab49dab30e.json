{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/sanata/Desktop/InpGram/InstaClone/src/client/Screens/Profile/EditPic.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport axios from \"axios\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport { COLORS, SIZES, FONTS } from \"../../constants\";\nimport { connect } from \"react-redux\";\nimport ActionButton from \"react-native-action-button\";\nimport AsyncStorage from \"@react-native-community/async-storage\";\nimport Icon from \"@expo/vector-icons/Ionicons\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { firebaseConfig } from \"../../fireBaseConfig\";\nimport uuid from \"uuid\";\nimport { AddImageProfile, InputField, InputWrapper, AddImage, SubmitBtn, SubmitBtnText, StatusWrapper } from \"./style/addPostStyle\";\nimport firebase from \"firebase\";\nimport { baseURL } from \"../../constants\";\n\nvar EditPic = function EditPic(props) {\n  if (!firebase.apps.length) {\n    firebase.initializeApp(firebaseConfig);\n  }\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      image = _useState2[0],\n      setImage = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      uploading = _useState4[0],\n      setUploading = _useState4[1];\n\n  var _useState5 = useState(0),\n      _useState6 = _slicedToArray(_useState5, 2),\n      transferred = _useState6[0],\n      setTransferred = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      caption = _useState8[0],\n      setCaption = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      _useState10 = _slicedToArray(_useState9, 2),\n      userId = _useState10[0],\n      setUserId = _useState10[1];\n\n  var didMountRef = useRef(false);\n  useEffect(function () {\n    setImage(props.postdata.urlpost);\n\n    (function _callee() {\n      var _await$ImagePicker$re, status;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(Platform.OS !== \"web\")) {\n                _context.next = 6;\n                break;\n              }\n\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(ImagePicker.requestMediaLibraryPermissionsAsync());\n\n            case 3:\n              _await$ImagePicker$re = _context.sent;\n              status = _await$ImagePicker$re.status;\n\n              if (status !== \"granted\") {\n                alert(\"Sorry, we need camera roll permissions to make this work!\");\n              }\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n\n    (function _callee2() {\n      var Id;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"Id\"));\n\n            case 2:\n              Id = _context2.sent;\n              setUserId(Id);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n\n    if (didMountRef.current) {\n      if (props.isModified) {\n        props.navigation.navigate(\"Profile\");\n      }\n    } else {\n      didMountRef.current = true;\n    }\n  }, [props.isModified]);\n\n  var uploadFromCamera = function uploadFromCamera() {\n    ImagePicker.launchCameraAsync({\n      width: 500,\n      height: 500,\n      cropping: false,\n      allowsEditing: true\n    }).then(function (image) {\n      var imageUri = Platform.OS === \"ios\" ? image.sourceURL : image.path;\n      setImage(image.uri);\n    });\n  };\n\n  var uploadFromGallery = function uploadFromGallery() {\n    var result;\n    return _regeneratorRuntime.async(function uploadFromGallery$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n              mediaTypes: ImagePicker.MediaTypeOptions.All,\n              allowsEditing: true,\n              width: 500,\n              height: 500,\n              quality: 1\n            }));\n\n          case 2:\n            result = _context3.sent;\n\n            if (!result.cancelled) {\n              setImage(result.uri);\n            }\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var submitPost = function submitPost() {\n    var imageUrl;\n    return _regeneratorRuntime.async(function submitPost$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return _regeneratorRuntime.awrap(uploadImageAsync());\n\n          case 2:\n            imageUrl = _context4.sent;\n            _context4.t0 = axios;\n            _context4.t1 = baseURL;\n            _context4.t2 = {\n              id: props.postdata.userid,\n              url: imageUrl\n            };\n            _context4.next = 8;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"token\"));\n\n          case 8:\n            _context4.t3 = _context4.sent;\n            _context4.t4 = {\n              \"auth-token\": _context4.t3\n            };\n            _context4.t5 = {\n              method: \"post\",\n              url: \"/uploadprofilephoto\",\n              baseURL: _context4.t1,\n              data: _context4.t2,\n              headers: _context4.t4\n            };\n            (0, _context4.t0)(_context4.t5).then(function (res) {\n              var message = res.data.message;\n\n              if (message === \"POST UPLOADED\") {\n                Alert.alert(\"Image uploaded!\");\n              } else {\n                Alert.alert(\"Image is not uploaded!\");\n              }\n            }).catch(function (err) {\n              console.log(\"postsActions.js, upload Request Error: \", err.message);\n            });\n\n          case 12:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  function uploadImageAsync() {\n    var uri, blob, ref, snapshot;\n    return _regeneratorRuntime.async(function uploadImageAsync$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            uri = image;\n            setUploading(true);\n            _context5.next = 4;\n            return _regeneratorRuntime.awrap(new Promise(function (resolve, reject) {\n              var xhr = new XMLHttpRequest();\n\n              xhr.onload = function () {\n                resolve(xhr.response);\n              };\n\n              xhr.onerror = function (e) {\n                reject(new TypeError(\"Network request failed\"));\n              };\n\n              xhr.responseType = \"blob\";\n              xhr.open(\"GET\", uri, true);\n              xhr.send(null);\n            }));\n\n          case 4:\n            blob = _context5.sent;\n            ref = firebase.storage().ref().child(uuid.v4());\n            _context5.next = 8;\n            return _regeneratorRuntime.awrap(ref.put(blob));\n\n          case 8:\n            snapshot = _context5.sent;\n            blob.close();\n            setUploading(false);\n            setImage(null);\n            _context5.next = 14;\n            return _regeneratorRuntime.awrap(snapshot.ref.getDownloadURL());\n\n          case 14:\n            return _context5.abrupt(\"return\", _context5.sent);\n\n          case 15:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  return React.createElement(View, {\n    style: styles.container,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 5\n    }\n  }, React.createElement(InputWrapper, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }\n  }, image != null ? React.createElement(AddImageProfile, {\n    source: {\n      uri: image\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 26\n    }\n  }) : null, uploading ? React.createElement(StatusWrapper, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 11\n    }\n  }, React.createElement(Text, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }\n  }, \"Completed! \")) : React.createElement(TouchableOpacity, {\n    style: {\n      height: 50,\n      width: 120,\n      backgroundColor: \"#48bfe3\",\n      borderRadius: SIZES.radius / 0.2,\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      marginTop: 25\n    },\n    onPress: submitPost,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 11\n    }\n  }, React.createElement(Text, {\n    style: _objectSpread({\n      color: COLORS.white\n    }, FONTS.h3),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }\n  }, \"Save\"))), React.createElement(ActionButton, {\n    buttonColor: \"#f15bb5\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }\n  }, React.createElement(ActionButton.Item, {\n    buttonColor: \"#06d6a0\",\n    title: \"Camera\",\n    onPress: uploadFromCamera,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 9\n    }\n  }, React.createElement(Icon, {\n    name: \"camera-outline\",\n    style: styles.actionButtonIcon,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 11\n    }\n  })), React.createElement(ActionButton.Item, {\n    buttonColor: \"#118ab2\",\n    title: \"Gallery\",\n    onPress: uploadFromGallery,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 9\n    }\n  }, React.createElement(Icon, {\n    name: \"md-images-outline\",\n    style: styles.actionButtonIcon,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 11\n    }\n  }))));\n};\n\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  actionButtonIcon: {\n    fontSize: 20,\n    height: 22,\n    color: \"white\"\n  }\n});\n\nvar mapStatetoProps = function mapStatetoProps(state) {\n  return {\n    isModified: state.postsReducer.isModified,\n    postdata: state.postsReducer.postdata\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {};\n};\n\nexport default connect(mapStatetoProps, mapDispatchToProps)(EditPic);","map":{"version":3,"sources":["/home/sanata/Desktop/InpGram/InstaClone/src/client/Screens/Profile/EditPic.js"],"names":["React","useState","useEffect","useRef","axios","COLORS","SIZES","FONTS","connect","ActionButton","AsyncStorage","Icon","ImagePicker","firebaseConfig","uuid","AddImageProfile","InputField","InputWrapper","AddImage","SubmitBtn","SubmitBtnText","StatusWrapper","firebase","baseURL","EditPic","props","apps","length","initializeApp","image","setImage","uploading","setUploading","transferred","setTransferred","caption","setCaption","userId","setUserId","didMountRef","postdata","urlpost","Platform","OS","requestMediaLibraryPermissionsAsync","status","alert","getItem","Id","current","isModified","navigation","navigate","uploadFromCamera","launchCameraAsync","width","height","cropping","allowsEditing","then","imageUri","sourceURL","path","uri","uploadFromGallery","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","quality","result","cancelled","submitPost","uploadImageAsync","imageUrl","id","userid","url","method","data","headers","res","message","Alert","catch","err","console","log","Promise","resolve","reject","xhr","XMLHttpRequest","onload","response","onerror","e","TypeError","responseType","open","send","blob","ref","storage","child","v4","put","snapshot","close","getDownloadURL","styles","container","backgroundColor","borderRadius","radius","alignItems","justifyContent","marginTop","color","white","h3","actionButtonIcon","StyleSheet","create","flex","fontSize","mapStatetoProps","state","postsReducer","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport axios from \"axios\";\n\nimport {\n  View,\n  Text,\n  Platform,\n  StyleSheet,\n  Alert,\n  TouchableOpacity,\n} from \"react-native\";\nimport { COLORS, SIZES, FONTS } from \"../../constants\";\n\nimport { connect } from \"react-redux\";\nimport ActionButton from \"react-native-action-button\";\nimport AsyncStorage from \"@react-native-community/async-storage\";\n\nimport Icon from \"react-native-vector-icons/Ionicons\";\nimport * as ImagePicker from \"expo-image-picker\";\n\nimport { firebaseConfig } from \"../../fireBaseConfig\";\nimport uuid from \"uuid\";\n\nimport {\n  AddImageProfile,\n  InputField,\n  InputWrapper,\n  AddImage,\n  SubmitBtn,\n  SubmitBtnText,\n  StatusWrapper,\n} from \"./style/addPostStyle\";\n\nimport firebase from \"firebase\";\nimport { baseURL } from \"../../constants\";\n\nconst EditPic = (props) => {\n  if (!firebase.apps.length) {\n    firebase.initializeApp(firebaseConfig);\n  }\n\n  const [image, setImage] = useState(null);\n  const [uploading, setUploading] = useState(false);\n  const [transferred, setTransferred] = useState(0);\n  const [caption, setCaption] = useState(null);\n  const [userId, setUserId] = useState(\"\");\n\n  const didMountRef = useRef(false);\n\n  useEffect(() => {\n    setImage(props.postdata.urlpost);\n    (async () => {\n      if (Platform.OS !== \"web\") {\n        const { status } =\n          await ImagePicker.requestMediaLibraryPermissionsAsync();\n        if (status !== \"granted\") {\n          alert(\"Sorry, we need camera roll permissions to make this work!\");\n        }\n      }\n    })();\n    (async () => {\n      const Id = await AsyncStorage.getItem(\"Id\");\n      setUserId(Id);\n    })();\n    if (didMountRef.current) {\n      // if login success, go to home screen\n      if (props.isModified) {\n        props.navigation.navigate(\"Profile\");\n      }\n    } else {\n      didMountRef.current = true;\n    }\n  }, [props.isModified]);\n\n  const uploadFromCamera = () => {\n    ImagePicker.launchCameraAsync({\n      width: 500,\n      height: 500,\n      cropping: false,\n      allowsEditing: true,\n    }).then((image) => {\n      const imageUri = Platform.OS === \"ios\" ? image.sourceURL : image.path;\n      setImage(image.uri);\n    });\n  };\n\n  const uploadFromGallery = async () => {\n    let result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.All,\n      allowsEditing: true,\n      width: 500,\n      height: 500,\n      quality: 1,\n    });\n\n    if (!result.cancelled) {\n      setImage(result.uri);\n    }\n  };\n\n  const submitPost = async () => {\n    const imageUrl = await uploadImageAsync();\n\n    axios({\n      method: \"post\",\n      url: \"/uploadprofilephoto\",\n      baseURL: baseURL,\n      data: {\n        id: props.postdata.userid,\n        url: imageUrl,\n      },\n      headers: {\n        \"auth-token\": await AsyncStorage.getItem(\"token\"),\n      },\n    })\n      .then((res) => {\n        const message = res.data.message;\n        if (message === \"POST UPLOADED\") {\n          //dispatch(uploadSuccess(Data));\n          Alert.alert(\"Image uploaded!\");\n        } else {\n          // dispatch(uploadFailure(message));\n          Alert.alert(\"Image is not uploaded!\");\n        }\n      })\n      .catch((err) => {\n        console.log(\"postsActions.js, upload Request Error: \", err.message);\n        //dispatch(uploadFailure(\"Fail to Upload\"));\n      });\n  };\n\n  async function uploadImageAsync() {\n    const uri = image;\n\n    setUploading(true);\n    const blob = await new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.onload = function () {\n        resolve(xhr.response);\n      };\n      xhr.onerror = function (e) {\n        reject(new TypeError(\"Network request failed\"));\n      };\n      xhr.responseType = \"blob\";\n      xhr.open(\"GET\", uri, true);\n      xhr.send(null);\n    });\n\n    const ref = firebase.storage().ref().child(uuid.v4());\n    const snapshot = await ref.put(blob);\n\n    // We're done with the blob, close and release it\n    blob.close();\n\n    setUploading(false);\n    setImage(null);\n\n    //Alert.alert(\"Image uploaded!\");\n    return await snapshot.ref.getDownloadURL();\n  }\n\n  return (\n    <View style={styles.container}>\n      <InputWrapper>\n        {image != null ? <AddImageProfile source={{ uri: image }} /> : null}\n\n        {uploading ? (\n          <StatusWrapper>\n            <Text>Completed! </Text>\n          </StatusWrapper>\n        ) : (\n          <TouchableOpacity\n            style={{\n              height: 50,\n              width: 120,\n              backgroundColor: \"#48bfe3\",\n              borderRadius: SIZES.radius / 0.2,\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              marginTop: 25,\n            }}\n            onPress={submitPost}\n          >\n            <Text style={{ color: COLORS.white, ...FONTS.h3 }}>Save</Text>\n          </TouchableOpacity>\n        )}\n      </InputWrapper>\n      <ActionButton buttonColor=\"#f15bb5\">\n        <ActionButton.Item\n          buttonColor=\"#06d6a0\"\n          title=\"Camera\"\n          onPress={uploadFromCamera}\n        >\n          <Icon name=\"camera-outline\" style={styles.actionButtonIcon} />\n        </ActionButton.Item>\n        <ActionButton.Item\n          buttonColor=\"#118ab2\"\n          title=\"Gallery\"\n          onPress={uploadFromGallery}\n        >\n          <Icon name=\"md-images-outline\" style={styles.actionButtonIcon} />\n        </ActionButton.Item>\n      </ActionButton>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  actionButtonIcon: {\n    fontSize: 20,\n    height: 22,\n    color: \"white\",\n  },\n});\n\nconst mapStatetoProps = (state) => {\n  return {\n    isModified: state.postsReducer.isModified,\n    postdata: state.postsReducer.postdata,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    // only map needed dispatches here\n    //modifypost: (data) => dispatch(modifypost(data)),\n  };\n};\n\nexport default connect(mapStatetoProps, mapDispatchToProps)(EditPic);\n"]},"metadata":{},"sourceType":"module"}